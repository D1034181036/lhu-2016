<!DOCTYPE html>
<html>
 	<head>
	  	<!-- meta data -->
	  	<meta charset="UTF-8"/>
	    <title>Foodpanda Map</title>

	    <!-- css -->
	    <style type="text/css">
	    	#map{
			    height: 100%;
			}

			html,body{
			    height: 100%;
			    margin: 0;
			    padding: 0;
			}
	    </style>

	    <!-- js -->
	    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
	    <script type='text/javascript' src='http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.7.1.js'></script>

	    <!-- google maps api -->
	    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRVLmnc_3OUqEyAuc29FB70R-8DfUFEpM&callback=initMap&libraries=&v=weekly" defer></script>

	    <!-- main js -->
	    <script type="text/javascript">
	    	function initMap(){
			    //init map
			    var initPos = { lat: 25.0640087, lng: 121.659068 };
			    map = new google.maps.Map(document.getElementById("map"), {
			        center: initPos,
			        zoom: 17,
			    });

			    xmlhttp = new XMLHttpRequest();
			    xmlhttp.onreadystatechange = function() {
			        if (this.readyState == 4 && this.status == 200) {
			            json_data = JSON.parse(this.responseText);

			            var positionArray = json_data["data"]["items"];
			            for (var i=0; i<positionArray.length; i++) {
			                positionArray[i]["lat"] = positionArray[i]["latitude"];
			                positionArray[i]["lng"] = positionArray[i]["longitude"];
			                new google.maps.Marker({
			                    position: positionArray[i],
			                    map,
			                    icon: createMarkerIcon(positionArray[i]["name"], {bgColor: "brown"})
			                });
			            }
			        }
			    };

			    xmlhttp.open("GET", "https://disco.deliveryhero.io/listing/api/v1/pandora/vendors?latitude="+25.0640087+"&longitude="+121.659068+"&language_id=6&include=characteristics&new_sorting=true&dynamic_pricing=0&configuration=Original&country=tw&customer_id=&customer_hash=&budgets=&cuisine=&food_characteristic=&vertical=restaurants&customer_type=regular", true);
			    xmlhttp.setRequestHeader("x-disco-client-id", "web");
			    xmlhttp.send();

			}

			//利用canvas產生一個內含文字的圖檔
			function createMarkerIcon(text, opt) {
			    //定義預設參數
			    var defaultOptions = {
			        fontStyle: "normal", //normal, bold, italic
			        fontName: "Arial",
			        fontSize: 12, //以Pixel為單位
			        bgColor: "darkblue",
			        fgColor: "white",
			        padding: 4,
			        arrowHeight: 6 //下方尖角高度
			    };
			    options = $.extend(defaultOptions, opt);
			    //建立Canvas，開始幹活兒
			    var canvas = document.createElement("canvas"),
			        context = canvas.getContext("2d");
			    //評估文字尺寸
			    var font = options.fontStyle + " " + options.fontSize + "px " + 
			               options.fontName;
			    context.font = font;
			    var metrics = context.measureText(text);
			    //文字大小加上padding作為外部尺寸
			    var w = metrics.width + options.padding * 2;
			    //高度以Font的大小為準
			    var h = options.fontSize + options.padding * 2 +
			            options.arrowHeight;
			    canvas.width = w;
			    canvas.height = h;
			    //邊框及背景
			    context.beginPath();
			    context.rect(0, 0, w, h - options.arrowHeight);
			    context.fillStyle = options.bgColor;
			    context.fill();
			    //畫出下方尖角
			    context.beginPath();
			    var x = w / 2, y = h, arwSz = options.arrowHeight;
			    context.moveTo(x, y);
			    context.lineTo(x - arwSz, y - arwSz);
			    context.lineTo(x + arwSz, y - arwSz);
			    context.lineTo(x, y);
			    context.fill();
			    //印出文字
			    context.textAlign = "center";
			    context.fillStyle = options.fgColor;
			    context.font = font;
			    context.fillText(text, w / 2, (h - options.arrowHeight) / 2 + options.padding);
			    //傳回DataURI字串
			    return canvas.toDataURL();
			}
	    </script>
	</head>

	<body>
		<div id="map"></div>
	</body>
</html>